# 🔐 安全设置功能测试指南

## 📋 已实现的安全功能

### 1. 会话超时控制
- ✅ 前端允许设置1-480分钟的会话超时时间
- ✅ 后端API验证范围调整为1-480分钟
- ✅ JWT令牌创建时使用数据库中的会话超时设置
- ✅ 新登录的用户会使用最新的超时设置

### 2. 密码最小长度控制
- ✅ 前端允许设置1-50位的密码最小长度
- ✅ 后端API验证范围调整为1-50位
- ✅ 修改密码时使用数据库中的最小长度设置
- ✅ 动态验证密码长度要求

### 3. 登录失败限制（新增）
- ✅ 用户表添加登录安全字段
- ✅ 跟踪连续登录失败次数
- ✅ 达到最大失败次数后锁定账户30分钟
- ✅ 使用数据库中的maxLoginAttempts设置
- ✅ 锁定期间显示剩余时间

## 🧪 测试步骤

### 测试1：会话超时功能
1. **设置会话超时**
   - 登录管理后台
   - 进入"系统管理" → "系统设置"
   - 将"会话超时时间"设置为1分钟
   - 点击"保存设置"

2. **验证设置生效**
   - 退出登录
   - 重新登录（获得1分钟超时的新令牌）
   - 等待1分钟后，尝试访问任何页面
   - 应该自动跳转到登录页面

### 测试2：密码最小长度功能
1. **设置密码最小长度**
   - 将"密码最小长度"设置为8位
   - 保存设置

2. **验证密码验证**
   - 进入"个人资料" → "修改密码"
   - 尝试设置7位密码
   - 应该显示"新密码长度至少为8位"错误

### 测试3：登录失败限制功能
1. **设置最大登录尝试次数**
   - 将"最大登录尝试次数"设置为3次
   - 保存设置

2. **测试登录失败限制**
   - 退出登录
   - 连续输入3次错误密码
   - 第4次尝试时应该显示账户被锁定的消息
   - 等待30分钟后才能重新尝试登录

## 🔍 验证要点

### 会话超时验证
- [ ] 前端InputNumber组件允许输入1分钟
- [ ] 设置保存成功，无错误提示
- [ ] 重新登录后，1分钟后会话确实过期
- [ ] 过期后API请求返回401状态码

### 密码长度验证
- [ ] 前端允许设置1-50位的最小长度
- [ ] 修改密码时动态验证长度
- [ ] 错误消息显示正确的最小长度要求

### 登录失败限制验证
- [ ] 连续失败次数正确计数
- [ ] 达到最大次数后账户被锁定
- [ ] 锁定期间显示剩余时间
- [ ] 锁定过期后可以正常登录
- [ ] 成功登录后失败计数重置

## 🚨 注意事项

### 会话超时测试
- **重要**：必须重新登录才能获得新的超时时间
- 现有的JWT令牌仍使用旧的过期时间
- 建议在测试前清除浏览器缓存

### 登录失败限制测试
- 测试时请使用测试账号，避免锁定主账号
- 锁定时间为30分钟，请耐心等待或联系管理员重置
- 数据库迁移可能需要手动执行

### 数据库迁移
如果登录失败限制功能不工作，可能需要手动添加数据库字段：
```sql
ALTER TABLE users ADD COLUMN failed_login_attempts INTEGER DEFAULT 0;
ALTER TABLE users ADD COLUMN locked_until TIMESTAMP WITH TIME ZONE;
ALTER TABLE users ADD COLUMN last_failed_login TIMESTAMP WITH TIME ZONE;
```

## 📊 预期结果

### 成功标志
- ✅ 会话超时：1分钟后自动退出登录
- ✅ 密码长度：动态验证最小长度要求
- ✅ 登录限制：达到最大次数后账户锁定30分钟

### 失败排查
如果功能不工作，检查：
1. Railway部署是否成功
2. 数据库字段是否添加成功
3. 设置是否正确保存到数据库
4. 浏览器是否使用了缓存的旧令牌

## 🎯 测试完成确认

完成所有测试后，请确认：
- [ ] 会话超时功能正常工作
- [ ] 密码最小长度验证生效
- [ ] 登录失败限制功能正常
- [ ] 所有设置都能正确保存和应用
- [ ] 用户体验良好，错误提示清晰

---

**测试建议**：建议按顺序进行测试，每个功能测试完成后再进行下一个，避免相互干扰。
